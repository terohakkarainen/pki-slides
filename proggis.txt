PKI-tutoriaali

---
Public key cryptography

- Kaksi eri avainta eri tarkoituksiin (asymmetrinen salaus):
-- Julkinen avain, jonka voi vapaasti jakaa maailmalle
-- Yksityinen avain, jonka omistaja pitää vain omana tietonaan
- Julkinen avain muodostetaan yksityisestä avaimesta
-- Oletus: Julkisesta avaimesta ei voi johtaa yksityistä avainta (nykyisellä laskentateholla järkevässä ajassa)

---
Algoritmeja
- Muodostavat kryptografian matemaattisen perustan
- RSA (Rivest-Shamir-Adleman, 1977), salaus ja allekirjoitus
-- Käytetyin
- DSA (Digital Signature Algorithm, 1991), vain allekirjoitus
- ja muitakin luonnollisesti on, esim. ECC (Elliptic Curve Cryptography), seuraavan sukupolven algoritmiperhe

---
RSA-avain

- Valitaan kaksi suurta alkulukua
- Avaimen turvallisuus perustuu siihen, ettei kahden suuren alkuluvun tuloa pystytä jakamaan tekijöihinsä järkevässä ajassa
- Kvanttitietokoneet muuttavat tilanteen?
- Mitä isommat alkuluvut, sitä turvallisempi avain on (1k, 2k, 4k, 8k, ...)
- Rankasti yksinkertaistaen alkuluvut ovat yksityinen avain ja niiden tulo on julkinen avain (tämä on ainakin helppo ymmärtää)

---
Salaus ja purku

http://www.mcseven.me/wp-content/uploads/2009/05/rsa_encryption.png

---
Allekirjoitus

- http://www.mcseven.me/wp-content/uploads/2009/05/rsa_signing.png
- Allekirjoitettavaa dataa ei allekirjoiteta kokonaisuudessaan (olisi hidasta)
-- Datasta lasketaan tiiviste (hash, digest), ja tiiviste allekirjoitetaan
-- Allekirjoituksen verifioija laskee myös saamastaan datasta tiivisteen, ja vertaa sitä allekirjoitettuun tiivisteeseen

---
Varmenne

- Tarkoitetaan X.509-standardin mukaisia varmenteita
- Varmenne on rakenteinen ASN.1-enkoodattu datamöhkö
-- ASN.1 sisältää perusrakennuspalikat primitiivien ja taulukoiden enkoodaukseen
- Varmenne on myöntäjänsä allekirjoittama dokumentti
-- Myöntäjä luottaa siihen, että varmenteen omistajalla on hallussaan julkista avainta vastaava yksityinen avain
- Varmenne sisältää vain julkista tietoa (ei yksityistä avainta)
- Varmenteen sisältö:
-- Julkinen avain siitä avainparista, jonka varmenne varmentaa
-- Myöntäjän julkinen avain
-- Allekirjoitus
-- Metadataa (käyttötarkoitus, voimassaoloaika, sulkulistan sijainti, jne.)

---
Varmenneketju

- Varmenteella on aina yksi myöntäjä
- Myöntäjävarmenteellakin on (yleensä) myöntäjä
- Ketjun päästä löytyy juurivarmenne, jonka allekirjoittaja on se itse (self-signed)
- Varmenteet juurivarmenteesta lehtivarmenteeseen (end-entity certificate) muodostavat varmenneketjun
- Varmenteen tarkistajalla pitää olla tiedossaan koko ketju

---
PKI

- PKI=Public Key Infrastructure
- Infra, jolla mahdollistetaan turvallinen tiedon salaus ja allekirjoitus
- Kuva: https://en.wikipedia.org/wiki/Public_key_infrastructure#/media/File:Public-Key-Infrastructure.svg
-- CA: Certificate Authority
--- Varmenteiden myöntäjä (myöntäjäavaimen haltija), sulkulistojen julkaisija
-- RA: Registration Authority
--- Varmennepyyntöjen välittäjä
-- VA: Validation Authority
--- Varmenteen validiteetin ratkaisija
-- Käyttäjä
--- Avaimen haltija, varmenteen tarvitsija
-- Kauppa
--- Allekirjoituksen tarvitsija

---
TLS (SSL)
- TLS-kättelyssä client ja server lähettävät toisilleen RSA-allekirjoitettuja viestejä.
- Allekirjoituksien verifiointiin tarvitaan varmenneketjuja:
-- Server-side authentication: Client tarkistaa serverin ketjun
-- Mutual authentication: Sekä client että server tarkistavat toistensa ketjut
- Liikennettä ei salata RSA:lla, koska se olisi tehotonta
- Kättelyssä sovitaan pienempi väliaikainen istuntoavain, jolla liikenne oikeasti salataan.

---
Java Keytool

- Käsittelee Java keystoreja (JKS), jotka ovat varmenne-avain-kirjekuoria
-- Osaa käsitellä myös PKCS12-kirjekuoria (standardi)
- Kirjekuoren idea on se, ettei yksityistä avainta saa sieltä millään ulos
- Tulee JDK:n mukana

---
OpenSSL

- Käsittelee avain- ja varmennetiedostoja sekä PKCS12-kirjekuoria
- Suurin piirtein kaikkien Linux-distrojen vakiosofta

---
